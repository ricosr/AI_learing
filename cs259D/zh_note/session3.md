# 僵尸网络，内部威胁

## 域名的恶意使用
- 肉机：定位C&C 
- 垃圾/钓鱼邮件：URL链接到诈骗服务器

## 通过DNS侦测恶意域名：EXPOSURE (2011)
- 目标：侦测恶意域名
- 使用从权威DNS服务器到递归DNS服务器的流量构建特性
   - 查询域名，发出查询的时间，TTL，与域相关的IP地址列表

## 特征
- F1: 基于时间的特征
   - 域名的短生命期限（时间序列分析中，不正常的域名会在短时间内突然出现后减少甚至消失）
   - 每天的相似性（域名每天相同时段的请求增加和减少量，访问时间序列的欧式距离，算法见论文）
   - 重复模式（定期重复，CPD算法见论文）
   - 访问比率（域名处于空闲还是繁忙状态）
- F2: 基于DNS应答的特征
   - 给定域解析的不同IP地址的数量（攻击者常常会将域名映射到多个IP）
   - 这些IP地址位于不同国家的数量（攻击者是机会主义，所以不考虑位置）
   - 给定域名解析出IP的域的共享数量（恶意域名通常和其他域名共享IP，但是良性域名有事也有这种行为）
   - 返回IP地址的反向DNS查询结果（合法的网络托管提供商和共享托管服务通常在Google提供的前3个查询答案中排名，这有助于我们减少误报）
- F3: 基于TTL值的特征
   - TTL的平均值
   - TTL的标准差
   - 不同TTL值的数量（动态TTL的值较小）
   - 调整TTL的次数（我们发现具有复杂基础结构的恶意网络表现出频繁的TTL更改。 在这样的网络中，某些机器人被选为代理可以隐藏其他服务（例如命令和控制服务器））
   - 某些特定范围的TTL值的使用百分比（某些特定范围的TTL值的使用百分比通常表示恶意行为）
- F4: 基于域名的特征
   - 数字字符所占域名长度的百分比
   - 最长的有意义的字符串占域名长度的百分比
   - 说明：
      - 正常的域名易于记忆，恶意域名通常由DGA生成较为混乱
      - 有一些域名有数字或者拼音组成，不在字典中，可由搜索引擎搜索到的数量判断是否是正常域名
      - 两个特征组合在一起可以提高，FP值可以降低

## 基于时间的特征
- 全局范围：域名的短生命期限
- 局部范围：
   - 每天的相似性
      - 每天相同的时间段请求增加或减少的数量
   - 重复模式
      - 变更点检测实例（详见论文）
   - 访问比率
      - 闲置还是繁忙

## 检测突然的变化
- 每个域名的时间序列
   - P(t)=第t个小时请求的数量，最大值归一化处理
   - P-(t)=过去8个时间间隔的平均值
   - P+(t)=接下来的8个时间间隔的平均值
   - d(t) = |P+(t) - P-(t)|
- 使用累计求和算法(CUSUM)处理d(t)